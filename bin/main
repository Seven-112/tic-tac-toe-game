#!/usr/bin/env ruby

# rubocop:disable Style/ConditionalAssignment
require './library/Messages'

class TicTacToe

  attr_accessor :p_1, :p_2, :p_1_symb, :p_2_symb

  def initialize; end

  # This method Set players names and symbols
  def u_entry(player_msg)
    puts player_msg.to_s
    player = gets.chomp
  end

  # Check if name or symbol is already taken
  def compare_user_entry?
    @p_1 == @p_2
  end

  # This method draw the board for the game
  def board(table)
    i = 0
    while i < table.size
      puts '+---+---+---+'
      puts "| #{table[i]} | #{table[i + 1]} | #{table[i + 2]} |"
      i += 3
    end
    puts '+---+---+---+'
  end

  # This method return a modified array, places the symbols and valid an user's move
  def move(table, choice, symb)
    table[table.index(choice)] = symb
    table
  end

  # This method check if the game is ended
  def won
    false
  end

end


# Instaciate TicTacToe class
game = TicTacToe.new
game.p_1 = game.u_entry('Player1 enter your name: ')

# Instaciate Messages class
messages = Message.new
messages.info = game.p_1

while messages.name_length?(3, 10)
  game.p_1 = game.u_entry('Player1 name must be between 3 to 10 characters')
  messages.info = game.p_1
end

game.p_2 = game.u_entry("\nPlayer2 enter your name: ")
messages.info = game.p_2

while messages.name_length?(3, 10) || game.compare_user_entry?
  if game.compare_user_entry?
    game.p_2 = game.u_entry('Name already taken!')
    messages.info = game.p_2
  else
    game.p_2 = game.u_entry('Player2 name must be between 3 to 10 characters')
    messages.info = game.p_2
  end
end

# Choosing a symbols
puts "\nChoose a symbol 'x' or 'o' to play"
game.p_1_symb = game.u_entry("#{game.p_1}, choose a symbol: ")

until messages.valid_symbols?(game.p_1_symb)
  game.p_1_symb = game.u_entry("Invalid symbol, retry again 'x' or 'o'")
  messages.info = game.p_1
end

if game.p_1_symb == 'x'
  game.p_2_symb = 'o'
else
  game.p_2_symb = 'x'
end

# Display the Players
puts "\nLet's start, #{game.p_1}: (#{game.p_1_symb})"
puts "Let's start, #{game.p_2}: (#{game.p_2_symb})"

# init table
table = [1, 2, 3, 4, 5, 6, 7, 'x', 9]

# Dispaly the board
game.board(table)

# Start playing
loop do
  p_1_choice = game.u_entry("#{game.p_1} please select a number from 1-9")
  until messages.valid_nbr_from_board?(p_1_choice.to_i, 1, 9) && table.any?(p_1_choice.to_i)
    if table.none?(p_1_choice.to_i)
      p_1_choice = game.u_entry("\n#{game.p_1} Number already taken, retry")
    else
      p_1_choice = game.u_entry("#{game.p_1} please v select a number from 1-9")
    end
  end

  # move, player 1
  table = game.move(table, p_1_choice.to_i, game.p_1_symb.to_s)

  game.board(table)


  # won : win or draw, break the loop


  # p_2_choice = game.u_entry("#{game.p_2} please select a number from 1-9")
  # # until messages.valid_nbr_from_board?(p_2_choice.to_i, 1, 9)
  # #   p_2_choice = game.u_entry("#{game.p_2} please select a number from 1-9")
  # # end

  

end


#Display game board

# # Gets player names
# puts 'Player1 enter your name'
# player_one = gets.chomp
# while player_one.size < 3 || player_one.size > 10
#   puts 'Player1 name must be between 3 to 10 charaters'
#   player_one = gets.chomp
# end
# puts "\nPlayer2 enter your name"
# player_two = gets.chomp
# while player_two.size < 3 || player_two.size > 10 || player_two == player_one
#   if player_two == player_one
#     puts 'Name already taken! Choose an other name'
#   else
#     puts 'Player2 name must be between 3 to 10 charaters'
#   end
#   player_two = gets.chomp
# end

# # Display players names
# puts "\nThe first player is #{player_one}"
# puts "The second player is #{player_two}"

# # Chosing a symbol
# puts "\nChoose a symbol 'x' or 'o' to play"

# puts "\n#{player_one}, you are the first player, choose a symbol: "

# p_1_symb = gets.chomp
# while p_1_symb != 'x' && p_1_symb != 'o'
#   puts 'Player1, choose a symbol "x" or "o" '
#   p_1_symb = gets.chomp
# end

# p_1_symb == 'x' ? p_2_symb = 'o' : p_2_symb = 'x'

# # Display the board
# puts "\nLet's start, #{player_one}: (#{p_1_symb})"
# puts "Let's start, #{player_two}: (#{p_2_symb})"
# puts '+---+---+---+'
# puts '| 1 | 2 | 3 |'
# puts '+---+---+---+'
# puts '| 4 | 5 | 6 |'
# puts '+---+---+---+'
# puts '| 7 | 8 | 9 |'
# puts '+---+---+---+'

# # Select player choices
# game_on = true
# while game_on
#   puts "\n#{player_one} please select a number from 1-9 on the board"

#   p1_choice = gets.chomp.to_i
#   while p1_choice < 1 || p1_choice > 9
#     puts "#{player_one}, please choose the right number"
#     p1_choice = gets.chomp.to_i
#   end

#   puts '+---+---+---+'
#   puts '| x | 2 | 3 |'
#   puts '+---+---+---+'
#   puts '| 4 | 5 | 6 |'
#   puts '+---+---+---+'
#   puts '| 7 | 8 | 9 |'
#   puts '+---+---+---+'

#   puts "\n#{player_two} please select a number from 1-9 on the board"
#   p2_choice = gets.chomp.to_i
#   while p1_choice == p2_choice || p2_choice < 1 || p2_choice > 9
#     if p1_choice == p2_choice
#       puts 'This number has already been taken'
#     else
#       puts "#{player_two}, please choose the right number"
#     end
#     p2_choice = gets.chomp.to_i
#   end

#   puts '+---+---+---+'
#   puts '| x | o | o |'
#   puts '+---+---+---+'
#   puts '| o | x | o |'
#   puts '+---+---+---+'
#   puts '| x | x | o |'
#   puts '+---+---+---+'

#   message1 = "Great move #{player_one}, you won the game!"
#   if message1
#     puts message1
#     game_on = false
#   elsif message2
#     puts '+---+---+---+'
#     puts '| x | o | x |'
#     puts '+---+---+---+'
#     puts '| o | x | o |'
#     puts '+---+---+---+'
#     puts '| o | x | o |'
#     puts '+---+---+---+'
#     message2 = 'The game is tie!'
#     puts message2
#     game_on = false
#   end

# end

# rubocop:enable Style/ConditionalAssignment
